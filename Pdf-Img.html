<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PDF to Image Converter (Client Side)</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<!-- pdf.js CDN -->
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f7f9fb;
    padding: 2rem;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  #drop-area {
    border: 2px dashed #ccc;
    padding: 2rem;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 1rem;
  }
  #drop-area.hover {
    border-color: #00b09b;
    background-color: #e0f7f7;
  }
  input[type="file"] {
    display: none;
  }
  button {
    display: block;
    margin: 1rem auto;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(90deg, #00b09b, #96c93d);
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: linear-gradient(90deg, #019180, #85b338);
  }
  #status {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
  }
  #images-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 2rem;
    justify-content: center;
  }
  .image-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .page-img {
    max-width: 200px;
    border: 1px solid #ccc;
    margin-bottom: 0.5rem;
  }
</style>
</head>
<body>
<h1>PDF to Image Converter (Client Side)</h1>
<div id="drop-area">
  <p>Drag & Drop PDF files here or <button id="file-btn">Select Files</button></p>
  <input type="file" id="file-input" multiple accept="application/pdf" />
</div>
<button id="convert-btn" disabled>Convert PDF to Images</button>
<div id="status"></div>
<div id="images-container"></div>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('file-input');
  const fileBtn = document.getElementById('file-btn');
  const convertBtn = document.getElementById('convert-btn');
  const imagesContainer = document.getElementById('images-container');
  const statusDiv = document.getElementById('status');

  let selectedFiles = [];

  // Handle file selection
  fileBtn.onclick = () => fileInput.click();

  fileInput.onchange = () => {
    selectedFiles = Array.from(fileInput.files);
    updateUI();
  };

  // Drag & Drop handlers
  dropArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropArea.classList.add('hover');
  });
  dropArea.addEventListener('dragleave', () => {
    dropArea.classList.remove('hover');
  });
  dropArea.addEventListener('drop', (e) => {
    e.preventDefault();
    dropArea.classList.remove('hover');
    selectedFiles = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
    updateUI();
  });

  function updateUI() {
    if (selectedFiles.length > 0) {
      convertBtn.disabled = false;
    } else {
      convertBtn.disabled = true;
    }
    imagesContainer.innerHTML = '';
    statusDiv.innerText = '';
  }

  // Convert PDF to images with progress indicator
  document.getElementById('convert-btn').onclick = async () => {
    imagesContainer.innerHTML = '';
    statusDiv.innerText = 'Processing... Please wait.';
    let totalPages = 0;
    let processedPages = 0;

    for (const file of selectedFiles) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      totalPages += pdf.numPages;
    }

    for (const file of selectedFiles) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        const page = await pdf.getPage(pageNum);
        const viewport = page.getViewport({ scale: 1.5 }); // Lower scale for faster rendering (adjust as needed)
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({ canvasContext: context, viewport: viewport }).promise;

        const wrapper = document.createElement('div');
        wrapper.className = 'image-wrapper';

        const img = document.createElement('img');
        img.src = canvas.toDataURL('image/png');
        img.className = 'page-img';

        const filename = file.name.replace('.pdf', '');
        const caption = document.createElement('div');
        caption.innerText = `${filename} - Page ${pageNum}`;

        wrapper.appendChild(img);
        wrapper.appendChild(caption);
        imagesContainer.appendChild(wrapper);

        processedPages++;
        // Update progress
        statusDiv.innerText = `Processing page ${processedPages} of ${totalPages}...`;
      }
    }
    // Done
    statusDiv.innerText = 'Done! All pages processed.';
  };

  // Load pdf.js
  const script = document.createElement('script');
  script.src = 'https://mozilla.github.io/pdf.js/build/pdf.js';
  document.head.appendChild(script);
</script>
</body>
</html>
